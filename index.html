<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>V√≤ng Quay May M·∫Øn ITC</title>
  <link rel="stylesheet" href="css/typo/typo.css" />
  <link rel="stylesheet" href="css/hc-canvas-luckwheel.css" />
  <link href="./images/hengaplai.png" rel="icon" type="image/x-icon" />

  <style>
    body {
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
    }

    .hc-luckywheel-list img {
      width: 85px;
      height: 85px;
      object-fit: contain;
      display: block;
      margin: 20px auto 0;
    }

    .hc-luckywheel {
      position: fixed;
      top: 50%;
      left: 50%;
      margin-top: -250px;
      margin-left: -250px;
    }

    .swal2-popup {
      background: rgba(255, 255, 255, 0.95) !important;
      border-radius: 20px !important;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25) !important;
      padding: 25px !important;
    }

    .swal2-title {
      color: #222 !important;
      font-size: 26px !important;
      font-weight: 700 !important;
    }

    .swal2-content {
      color: #444 !important;
      font-size: 18px !important;
      margin-top: 10px !important;
    }

    /* Fix backdrop issue */
    .swal2-backdrop-show {
      background-color: transparent !important;
    }

    /* Simple SweetAlert styling - gi·ªëng popup th·ª© 2 */
    .simple-swal-popup {
      background: rgba(255, 255, 255, 0.98) !important;
      border-radius: 20px !important;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25) !important;
      padding: 25px !important;
    }

    .simple-swal-button {
      background: #3085d6 !important;
      border-radius: 25px !important;
      padding: 10px 25px !important;
      font-size: 16px !important;
      font-weight: 600 !important;
      border: none !important;
    }

    .simple-swal-button:hover {
      background: #2574c2 !important;
    }
  </style>
</head>

<body class="bg">
  <div id="content" class="container">
    <div id="post">
      <div class="wrapper typo" id="wrapper">
        <section id="luckywheel" class="hc-luckywheel">
          <div class="hc-luckywheel-container">
            <canvas class="hc-luckywheel-canvas" width="500" height="500">V√≤ng Xoay May M·∫Øn</canvas>
          </div>
          <a class="hc-luckywheel-btn" href="javascript:;">Xoay</a>
        </section>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
      <script src="js/hc-canvas-luckwheel.js"></script>
      <script>
        var isPercentage = true;
        var prizes = [
          {
            // text: "Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau",
            text: "Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi ITC",
            img: "images/hengaplai.png",
            percentpage: 0.25
          },
          {
            text: "Chu·ªôt Bluetooth",
            img: "images/chuot2.png",
            percentpage: 0.10
          },
          {
            text: "B√¨nh n∆∞·ªõc",
            img: "images/binh.png",
            percentpage: 0.22
          },
          {
            text: "USB 3.2 Kingston",
            img: "images/usb.png",
            percentpage: 0.3
          },
          {
            // text: "Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau",
            text: "Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi ITC",
            img: "images/hengaplai.png",
            percentpage: 0.25
          },
          {
            text: "G·∫•u b√¥ng",
            img: "images/gaubong.png",
            percentpage: 0.15
          },
          {
            text: "Qu√† b√≠ ·∫©n",
            img: "images/gift_Y.png",
            // number: 30,
            percentpage: 0.00
          },
          {
            text: "Balo ITC",
            img: "images/balo1.png",
            // number: 10,
            percentpage: 0.00
          },
        ];

        // SweetAlert2 c·∫•u h√¨nh
        const Toast = Swal.mixin({
          toast: true,
          position: 'center',
          showConfirmButton: false,
          timer: 8000,
          timerProgressBar: true,
          background: 'rgba(255, 255, 255, 0)',
          backdrop: false,
        });

        document.addEventListener(
          "DOMContentLoaded",
          function () {
            hcLuckywheel.init({
              id: "luckywheel",
              config: function (callback) {
                callback && callback(prizes);
              },
              mode: "both",
              getPrize: function (callback) {
                var rand = randomIndex(prizes);
                var chances = rand;
                callback && callback([rand, chances]);
              },
              gotBack: function (data, index) {
                console.log("=== GOTBACK CALLED ===");
                console.log("Raw data:", data);
                console.log("Index:", index);

                // T·∫ÆT TO√ÄN B·ªò SWEETALERT T·ª™ TH·ªúI ƒêI·ªÇM N√ÄY
                const originalSwal = window.Swal;
                window.Swal = {
                  fire: function () {
                    console.log("Swal.fire blocked from library");
                    return Promise.resolve();
                  }
                };

                // L·∫•y th√¥ng tin prize
                let prizeText = '';
                let prizeImg = '';

                if (typeof index === 'number' && prizes[index]) {
                  prizeText = prizes[index].text;
                  prizeImg = prizes[index].img;
                } else if (typeof data === 'string') {
                  prizeText = data;
                  let foundPrize = prizes.find(p => p.text === data);
                  prizeImg = foundPrize ? foundPrize.img : '';
                }

                console.log("Final prize text:", prizeText);
                console.log("Final prize img:", prizeImg);

                // Delay ƒë·ªÉ ƒë·∫£m b·∫£o th∆∞ vi·ªán kh√¥ng g·ªçi popup
                setTimeout(() => {
                  // KH√îI PH·ª§C L·∫†I SWAL
                  window.Swal = originalSwal;

                  // X·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p
                  if (data == null || prizeText == null) {
                    originalSwal.fire({
                      title: 'Ch∆∞∆°ng tr√¨nh k·∫øt th√∫c',
                      text: 'ƒê√£ h·∫øt ph·∫ßn th∆∞·ªüng',
                      icon: 'error',
                      confirmButtonText: 'ƒê√≥ng',
                      backdrop: false,
                      allowOutsideClick: false
                    });
                  } else if (prizeText === 'Join ITC family üíõ' || prizeText.includes('may m·∫Øn')) {
                    originalSwal.fire({
                      title: 'CH√ÄO M·ª™NG',
                      text: 'T√¢n sinh vi√™n ITC Kh√≥a 25',
                      imageUrl: './images/hengaplai.png',
                      imageWidth: 100,
                      imageHeight: 100,
                      confirmButtonText: 'OK',
                      backdrop: false,
                      allowOutsideClick: false,
                      customClass: {
                        popup: 'simple-swal-popup',
                        confirmButton: 'simple-swal-button'
                      }
                    });
                  } else {
                    // Popup cho c√°c ph·∫ßn th∆∞·ªüng kh√°c - giao di·ªán gi·ªëng h·ªát popup "may m·∫Øn l·∫ßn sau"
                    let displayImg = prizeImg || './images/logo.png';

                    originalSwal.fire({
                      title: 'Ch√∫c m·ª´ng!',
                      text: `B·∫°n ƒë√£ tr√∫ng: ${prizeText}`,
                      imageUrl: displayImg,
                      imageWidth: 120,
                      confirmButtonText: 'OK',
                      backdrop: false,
                      allowOutsideClick: false,
                      customClass: {
                        popup: 'simple-swal-popup',
                        confirmButton: 'simple-swal-button'
                      }
                    });
                  }
                }, 100);
              }
            });
          },
          false
        );

        // N·∫øu mu·ªën s·ª≠ d·ª•ng ph·∫£i th√™m gi√° tr·ªã number
        // function randomIndex(prizes) {
        //   if (isPercentage) {
        //     var counter = 0;
        //     for (let i = 0; i < prizes.length; i++) {
        //       if (prizes[i].number == 0) {
        //         counter++;
        //       }
        //     }
        //     if (counter == prizes.length) {
        //       return null;
        //     }

        //     let rand = Math.random();
        //     let prizeIndex = null;
        //     console.log("Random value:", rand);

        //     let cumulativeProbability = 0;
        //     for (let i = 0; i < prizes.length; i++) {
        //       cumulativeProbability += prizes[i].percentpage;
        //       if (rand < cumulativeProbability) {
        //         prizeIndex = i;
        //         break;
        //       }
        //     }

        //     console.log("Selected prize index:", prizeIndex, "Prize:", prizes[prizeIndex].text); // Debug log

        //     if (prizes[prizeIndex].number !== undefined && prizes[prizeIndex].number != 0) {
        //       prizes[prizeIndex].number--;
        //       return prizeIndex;
        //     } else if (prizes[prizeIndex].number === undefined) {
        //       return prizeIndex;
        //     } else {
        //       return randomIndex(prizes);
        //     }
        //   } else {
        //     var counter = 0;
        //     for (let i = 0; i < prizes.length; i++) {
        //       if (prizes[i].number == 0) {
        //         counter++;
        //       }
        //     }
        //     if (counter == prizes.length) {
        //       return null;
        //     }
        //     var rand = (Math.random() * (prizes.length)) >>> 0;
        //     if (prizes[rand].number !== undefined && prizes[rand].number != 0) {
        //       prizes[rand].number--;
        //       return rand;
        //     } else if (prizes[rand].number === undefined) {
        //       return rand;
        //     } else {
        //       return randomIndex(prizes);
        //     }
        //   }
        // }

        function randomIndex(prizes) {
          if (isPercentage) {
            let rand = Math.random();
            let cumulativeProbability = 0;
            for (let i = 0; i < prizes.length; i++) {
              cumulativeProbability += prizes[i].percentpage;
              if (rand < cumulativeProbability) {
                return i;
              }
            }
          } else {
            // n·∫øu kh√¥ng d√πng percent th√¨ random ƒë·ªÅu
            return (Math.random() * prizes.length) >>> 0;
          }
        }

      </script>
    </div>
  </div>
</body>

</html>